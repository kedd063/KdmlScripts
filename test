local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game.Workspace
local player = Players.LocalPlayer

-- === GUI ===
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "LockTimerESP_GUI"

-- Panel
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 250, 0, 100)
frame.Position = UDim2.new(0, 50, 0, 50)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.Parent = screenGui

local corner = Instance.new("UICorner", frame)
corner.CornerRadius = UDim.new(0, 8)

-- Başlık
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundTransparency = 1
title.Text = "Lock Timer ESP"
title.Font = Enum.Font.GothamBold
title.TextSize = 20
title.TextColor3 = Color3.new(1, 1, 1)
title.Parent = frame

-- Toggle Butonu
local toggle = Instance.new("TextButton")
toggle.Size = UDim2.new(0, 200, 0, 40)
toggle.Position = UDim2.new(0.5, -100, 0, 40)
toggle.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
toggle.TextColor3 = Color3.new(1, 1, 1)
toggle.Font = Enum.Font.GothamBold
toggle.TextSize = 16
toggle.Text = "ESP: OFF"
toggle.Parent = frame

local toggleCorner = Instance.new("UICorner", toggle)
toggleCorner.CornerRadius = UDim.new(0, 6)

-- === ESP Logic ===
local espEnabled = false
local espConnection
local activeESP = {}

local function clearESP()
    for _, gui in pairs(activeESP) do
        if gui and gui.Parent then
            gui:Destroy()
        end
    end
    activeESP = {}
end

local function enableESP()
    espConnection = RunService.RenderStepped:Connect(function()
        clearESP()
        local plots = Workspace:FindFirstChild("Plots")
        if not plots then return end

        for _, plot in ipairs(plots:GetChildren()) do
            local plotBlock = plot:FindFirstChild("PlotBlock", true)
            if plotBlock then
                local main = plotBlock:FindFirstChild("Main")
                if main then
                    local billboardGui = main:FindFirstChild("BillboardGui")
                    if billboardGui then
                        local label = billboardGui:FindFirstChild("RemainingTime")
                        if label and label:IsA("TextLabel") then
                            local billboard = Instance.new("BillboardGui")
                            billboard.Size = UDim2.new(0, 200, 0, 50)
                            billboard.Adornee = main
                            billboard.AlwaysOnTop = true
                            billboard.Parent = main

                            local textLabel = Instance.new("TextLabel")
                            textLabel.Size = UDim2.new(1, 0, 1, 0)
                            textLabel.BackgroundTransparency = 1
                            textLabel.Text = label.Text
                            textLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
                            textLabel.TextStrokeTransparency = 0
                            textLabel.TextScaled = true
                            textLabel.Font = Enum.Font.GothamBold
                            textLabel.Parent = billboard

                            table.insert(activeESP, billboard)
                        end
                    end
                end
            end
        end
    end)
end

local function disableESP()
    if espConnection then
        espConnection:Disconnect()
        espConnection = nil
    end
    clearESP()
end

-- Toggle Butonu Bağla
toggle.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    if espEnabled then
        toggle.Text = "ESP: ON"
        toggle.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
        enableESP()
    else
        toggle.Text = "ESP: OFF"
        toggle.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        disableESP()
    end
end)
