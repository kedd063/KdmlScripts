local player = game.Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "KdmlGui"
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Ana buton (solda)
local mainButton = Instance.new("ImageButton")
mainButton.Size = UDim2.new(0, 100, 0, 100)
mainButton.Position = UDim2.new(0, 10, 0.5, -50) -- solda ortada
mainButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
mainButton.AnchorPoint = Vector2.new(0, 0.5)
mainButton.Image = "rbxassetid://104833147631294"
mainButton.AutoButtonColor = true
mainButton.Name = "MainButton"
mainButton.Parent = screenGui

local mainCorner = Instance.new("UICorner", mainButton)
mainCorner.CornerRadius = UDim.new(0, 20)

-- Drag mekanizması (ana buton için)
local dragging = false
local dragInput, dragStart, startPos

local function update(input)
    local delta = input.Position - dragStart
    mainButton.Position = UDim2.new(
        startPos.X.Scale,
        startPos.X.Offset + delta.X,
        startPos.Y.Scale,
        startPos.Y.Offset + delta.Y
    )
    if panel then
        panel.Position = UDim2.new(mainButton.Position.X.Scale, mainButton.Position.X.Offset + 110, mainButton.Position.Y.Scale, mainButton.Position.Y.Offset)
    end
end

mainButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or
       input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainButton.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

mainButton.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or
       input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Ana panel (sağda, mainButton yanına)
local panel = Instance.new("Frame")
panel.Size = UDim2.new(0, 350, 0, 300)
panel.Position = UDim2.new(mainButton.Position.X.Scale, mainButton.Position.X.Offset + 110, mainButton.Position.Y.Scale, mainButton.Position.Y.Offset)
panel.BackgroundColor3 = Color3.fromRGB(128, 0, 128)
panel.Visible = false
panel.AnchorPoint = Vector2.new(0, 0.5)
panel.Parent = screenGui

local panelCorner = Instance.new("UICorner", panel)
panelCorner.CornerRadius = UDim.new(0, 15)

-- Panel draggable için değişkenler
local panelDragging = false
local panelDragInput, panelDragStart, panelStartPos

local function panelUpdate(input)
    local delta = input.Position - panelDragStart
    panel.Position = UDim2.new(
        panelStartPos.X.Scale,
        panelStartPos.X.Offset + delta.X,
        panelStartPos.Y.Scale,
        panelStartPos.Y.Offset + delta.Y
    )
end

-- Panel başlık çubuğu (drag için)
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 30)
titleBar.BackgroundColor3 = Color3.fromRGB(100, 0, 140)
titleBar.Parent = panel
titleBar.Name = "TitleBar"
titleBar.AnchorPoint = Vector2.new(0, 0)

local titleLabel = Instance.new("TextLabel")
titleLabel.Parent = titleBar
titleLabel.Size = UDim2.new(1, -10, 1, 0)
titleLabel.Position = UDim2.new(0, 5, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "Kdml Scripts"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 20
titleLabel.TextXAlignment = Enum.TextXAlignment.Left

-- TitleBar drag eventleri
titleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or
       input.UserInputType == Enum.UserInputType.Touch then
        panelDragging = true
        panelDragStart = input.Position
        panelStartPos = panel.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                panelDragging = false
            end
        end)
    end
end)

titleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or
       input.UserInputType == Enum.UserInputType.Touch then
        panelDragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == panelDragInput and panelDragging then
        panelUpdate(input)
    end
end)

-- Sekme butonları
local tabs = {"Main", "Visual", "Misc"}
local tabButtons = {}
local tabFrames = {}

local function setActiveTab(tabName)
    for _, tab in pairs(tabs) do
        tabFrames[tab].Visible = (tab == tabName)
        tabButtons[tab].BackgroundColor3 = (tab == tabName) and Color3.fromRGB(75,0,130) or Color3.fromRGB(40,40,40)
    end
end

local buttonSize = UDim2.new(0, 100, 0, 30)
for i, tab in ipairs(tabs) do
    local btn = Instance.new("TextButton")
    btn.Size = buttonSize
    btn.Position = UDim2.new(0, (i-1)*105 + 5, 0, 35)
    btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 18
    btn.Text = tab
    btn.Parent = panel
    btn.AutoButtonColor = true
    tabButtons[tab] = btn

    btn.MouseButton1Click:Connect(function()
        setActiveTab(tab)
    end)

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -10, 1, -70)
    frame.Position = UDim2.new(0, 5, 0, 70)
    frame.BackgroundTransparency = 1
    frame.Visible = false
    frame.Parent = panel
    tabFrames[tab] = frame
end

-- Başlangıçta Main sekmesi aktif olsun
setActiveTab("Main")

-- --- Main Sekmesi İçeriği ---
local mainFrame = tabFrames["Main"]

-- Instant Steal butonu
local instantStealButton = Instance.new("TextButton")
instantStealButton.Parent = mainFrame
instantStealButton.Size = UDim2.new(0, 330, 0, 40)
instantStealButton.Position = UDim2.new(0, 10, 0, 10)
instantStealButton.BackgroundColor3 = Color3.fromRGB(75, 0, 130)
instantStealButton.TextColor3 = Color3.new(1,1,1)
instantStealButton.Font = Enum.Font.GothamBold
instantStealButton.TextSize = 18
instantStealButton.Text = "Instant Stealn/code: Arbix Hub n/ ne olduğunu bilion demi"
instantStealButton.AutoButtonColor = true

local instantStealCorner = Instance.new("UICorner", instantStealButton)
instantStealCorner.CornerRadius = UDim.new(0, 10)

instantStealButton.MouseButton1Click:Connect(function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/Youifpg/Steal-a-Brianrot/refs/heads/main/Slowversion.lua"))()
end)

-- Teleport butonu (Main sekmesi)
local teleportButton = Instance.new("TextButton")
teleportButton.Parent = mainFrame
teleportButton.Size = UDim2.new(0, 330, 0, 40)
teleportButton.Position = UDim2.new(0, 10, 0, 60)
teleportButton.BackgroundColor3 = Color3.fromRGB(75, 0, 130)
teleportButton.TextColor3 = Color3.new(1,1,1)
teleportButton.Font = Enum.Font.GothamBold
teleportButton.TextSize = 18
teleportButton.Text = "Teleport 171 Stud Up/Down (Kaldırıldı)" -- kaldırdın demiştin
teleportButton.AutoButtonColor = true
teleportButton.Visible = false -- kaldırdığın için görünmez

-- Teleport fonksiyonu (bu butona ihtiyaç kalmadı)

-- --- Visual Sekmesi İçeriği ---
local visualFrame = tabFrames["Visual"]

local espEnabled = false
local espLabels = {}

local function createEspLabel(playerTarget)
    if espLabels[playerTarget] then return end
    local character = playerTarget.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end

    local billboard = Instance.new("BillboardGui")
    billboard.Name = "EspBillboard"
    billboard.Adornee = character.HumanoidRootPart
    billboard.Size = UDim2.new(0, 100, 0, 30)
    billboard.StudsOffset = Vector3.new(0, 2, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = playerTarget.PlayerGui or playerTarget:WaitForChild("PlayerGui")

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.new(1, 0, 0)
    label.Font = Enum.Font.GothamBold
    label.TextSize = 18
    label.Text = playerTarget.Name
    label.Parent = billboard

    espLabels[playerTarget] = billboard
end

local function removeEspLabels()
    for _, label in pairs(espLabels) do
        label:Destroy()
    end
    espLabels = {}
end

local espToggleButton = Instance.new("TextButton")
espToggleButton.Parent = visualFrame
espToggleButton.Size = UDim2.new(0, 330, 0, 40)
espToggleButton.Position = UDim2.new(0, 10, 0, 10)
espToggleButton.BackgroundColor3 = Color3.fromRGB(75, 0, 130)
espToggleButton.TextColor3 = Color3.new(1,1,1)
espToggleButton.Font = Enum.Font.GothamBold
espToggleButton.TextSize = 18
espToggleButton.Text = "Toggle ESP"
espToggleButton.AutoButtonColor = true

local espToggleCorner = Instance.new("UICorner", espToggleButton)
espToggleCorner.CornerRadius = UDim.new(0, 10)

espToggleButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    if espEnabled then
        for _, plr in pairs(game.Players:GetPlayers()) do
            if plr ~= player then
                createEspLabel(plr)
            end
        end
    else
        removeEspLabels()
    end
end)

-- --- Misc Sekmesi İçeriği ---
local miscFrame = tabFrames["Misc"]

local items = {
    "Trap",
    "Invisibility Cloak",
    "Medusa's Head",
    "Quantum Cloner",
    "Body Swap Potion",
}

for i, itemName in ipairs(items) do
    local btn = Instance.new("TextButton")
    btn.Parent = miscFrame
    btn.Size = UDim2.new(0, 330, 0, 35)
    btn.Position = UDim2.new(0, 10, 0, 10 + (i-1)*45)
    btn.BackgroundColor3 = Color3.fromRGB(75, 0, 130)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 18
    btn.Text = "Buy "..itemName
    btn.AutoButtonColor = true

    local corner = Instance.new("UICorner", btn)
    corner.CornerRadius = UDim.new(0, 10)

    btn.MouseButton1Click:Connect(function()
        local args = {itemName}
        local rf = game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("Net"):WaitForChild("RF/CoinsShopService/RequestBuy")
        rf:InvokeServer(unpack(args))
    end)
end

-- Ana butona tıklayınca panel açılır/kapanır
mainButton.MouseButton1Click:Connect(function()
    panel.Visible = not panel.Visible
end)
