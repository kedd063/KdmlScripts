local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local Stats = game:GetService("Stats")
local lp = Players.LocalPlayer
local random = Random.new()

local char, humanoid, hrp
local teleporting = false
local tpAmt = 120
local fixedY = 70

local function setupCharacter(newChar)
	char = newChar
	humanoid = char:WaitForChild("Humanoid")
	hrp = char:WaitForChild("HumanoidRootPart")
	humanoid.MaxHealth = math.huge
	humanoid.Health = math.huge
	humanoid.HealthChanged:Connect(function()
		if humanoid.Health < humanoid.MaxHealth then
			humanoid.Health = humanoid.MaxHealth
		end
	end)
	humanoid.Died:Connect(function()
		lp:LoadCharacter()
	end)
end

if lp.Character then setupCharacter(lp.Character) end
lp.CharacterAdded:Connect(setupCharacter)

local function getPing()
	local pingStats = Stats.Network.ServerStatsItem
	if pingStats then return pingStats:GetValue() / 1000 end
	return 0.1
end

local function TP(position)
	if not teleporting and position then
		teleporting = true
		hrp.CFrame = position + Vector3.new(
			random:NextNumber(-0.0001, 0.0001),
			random:NextNumber(-0.0001, 0.0001),
			random:NextNumber(-0.0001, 0.0001)
		)
		RunService.Heartbeat:Wait()
		teleporting = false
	end
end

local function TweenToPosition(targetCFrame, duration)
	local tweenInfo = TweenInfo.new(duration or 0.15, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
	local tween = TweenService:Create(hrp, tweenInfo, {CFrame = targetCFrame})
	tween:Play()
	task.wait(duration or 0.15)
	tween:Cancel()
	return true
end

local function TeleportToCoords(coords)
	if not (coords and #coords == 3) then return false end
	local target = CFrame.new(coords[1], coords[2], coords[3])

	local ping = getPing()
	local waitTime = math.clamp(ping, 0.02, 0.05)

	-- 2 kez hızlı TP
	for i = 1, 2 do
		TP(target)
		task.wait(waitTime / 2)
	end

	-- Tween (0.15 saniye)
	TweenToPosition(target, 0.15)

	-- 3 hızlı TP daha
	for i = 1, 3 do
		TP(target)
		task.wait(waitTime)
	end

	task.wait(0.1)

	-- Son 5 kez kısa aralıklarla TP denemesi
	for i = 1, 5 do
		if (hrp.Position - target.Position).Magnitude <= 10 then
			break
		end
		TP(target)
		task.wait(0.03)
	end

	task.wait(0.2)
	return (hrp.Position - target.Position).Magnitude <= 15
end

-- GUI Oluştur
local gui = Instance.new("ScreenGui", lp:WaitForChild("PlayerGui"))
gui.Name = "TPGUI"
gui.ResetOnSpawn = false

-- Sürüklenebilir Frame
local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 200, 0, 160)
frame.Position = UDim2.new(0, 10, 0.3, 0)
frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
frame.Active = true
frame.Draggable = true
Instance.new("UICorner", frame)

-- TP Butonu
local tpButton = Instance.new("TextButton", frame)
tpButton.Size = UDim2.new(1, -20, 0, 40)
tpButton.Position = UDim2.new(0, 10, 0, 10)
tpButton.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
tpButton.TextColor3 = Color3.new(1, 1, 1)
tpButton.Text = "Kdml Scripts | Roof TP"
tpButton.Font = Enum.Font.GothamBold
tpButton.TextScaled = true
Instance.new("UICorner", tpButton)

-- Infinite Yield Butonu
local iyButton = Instance.new("TextButton", frame)
iyButton.Size = UDim2.new(1, -20, 0, 40)
iyButton.Position = UDim2.new(0, 10, 0, 60)
iyButton.BackgroundColor3 = Color3.fromRGB(90, 90, 90)
iyButton.TextColor3 = Color3.new(1, 1, 1)
iyButton.Text = "Infinite Yield (for respawn)"
iyButton.Font = Enum.Font.GothamBold
iyButton.TextScaled = true
Instance.new("UICorner", iyButton)

iyButton.MouseButton1Click:Connect(function()
	loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))()
end)

tpButton.MouseButton1Click:Connect(function()
	if hrp then
		local pos = hrp.Position
		TeleportToCoords({pos.X, fixedY, pos.Z})
	end
end)
