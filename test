local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer

-- Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KdmlSimpleUI"
ScreenGui.Parent = player:WaitForChild("PlayerGui")

-- Main frame
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 350)
MainFrame.Position = UDim2.new(0.5, -150, 0.3, -175)
MainFrame.BackgroundColor3 = Color3.fromRGB(24, 24, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui
MainFrame.Active = true
MainFrame.Draggable = true

-- UI Corner for rounding
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

-- Title
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.BackgroundTransparency = 1
Title.Text = "Kdml Scripts"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 22
Title.TextColor3 = Color3.fromRGB(0, 170, 255)
Title.Parent = MainFrame

-- Tabs Frame
local TabsFrame = Instance.new("Frame")
TabsFrame.Size = UDim2.new(0, 100, 1, -40)
TabsFrame.Position = UDim2.new(0, 0, 0, 40)
TabsFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 24)
TabsFrame.BorderSizePixel = 0
TabsFrame.Parent = MainFrame

local UICornerTabs = Instance.new("UICorner")
UICornerTabs.CornerRadius = UDim.new(0, 10)
UICornerTabs.Parent = TabsFrame

-- Content Frame
local ContentFrame = Instance.new("ScrollingFrame")
ContentFrame.Size = UDim2.new(1, -100, 1, -40)
ContentFrame.Position = UDim2.new(0, 100, 0, 40)
ContentFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 28)
ContentFrame.BorderSizePixel = 0
ContentFrame.CanvasSize = UDim2.new(0, 0, 2, 0)
ContentFrame.ScrollBarThickness = 6
ContentFrame.Parent = MainFrame

local UICornerContent = Instance.new("UICorner")
UICornerContent.CornerRadius = UDim.new(0, 10)
UICornerContent.Parent = ContentFrame

-- Helper function to create buttons in ContentFrame
local function createButton(text, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 35)
    btn.Position = UDim2.new(0, 10, 0, 0)
    btn.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 16
    btn.Text = text
    btn.AutoButtonColor = true
    btn.Parent = ContentFrame

    btn.MouseButton1Click:Connect(callback)
    return btn
end

-- Helper function to create toggles in ContentFrame
local function createToggle(text, default, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -20, 0, 40)
    frame.BackgroundTransparency = 1
    frame.Parent = ContentFrame

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.Font = Enum.Font.Gotham
    label.TextSize = 16
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame

    local toggle = Instance.new("TextButton")
    toggle.Size = UDim2.new(0, 40, 0, 20)
    toggle.Position = UDim2.new(0.75, 0, 0.25, 0)
    toggle.BackgroundColor3 = default and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(50, 50, 60)
    toggle.Text = ""
    toggle.Parent = frame

    local toggled = default
    toggle.MouseButton1Click:Connect(function()
        toggled = not toggled
        toggle.BackgroundColor3 = toggled and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(50, 50, 60)
        callback(toggled)
    end)
    return frame
end

-- Tabs list and buttons
local tabs = {"Main", "Visual", "Misc", "Other Stuffs"}
local buttons = {}
local contentUpdateFunctions = {}

-- Clear ContentFrame helper
local function clearContent()
    for _, child in pairs(ContentFrame:GetChildren()) do
        if child:IsA("Frame") or child:IsA("TextButton") then
            child:Destroy()
        end
    end
end

-- Main tab content
contentUpdateFunctions["Main"] = function()
    clearContent()
    local y = 0

    local function addButton(name, cb)
        local btn = createButton(name, cb)
        btn.Position = UDim2.new(0, 10, 0, y)
        y = y + 40
    end

    addButton("Free Cam", function()
        loadstring(game:HttpGet('https://raw.githubusercontent.com/GhostPlayer352/Test4/main/Freecam'))()
    end)

    addButton("Speed Boost", function()
        local boostedSpeed = 48
        local function applySpeedBoost()
            local char = player.Character or player.CharacterAdded:Wait()
            local humanoid = char:WaitForChild("Humanoid")
            humanoid.WalkSpeed = boostedSpeed
        end
        applySpeedBoost()
        player.CharacterAdded:Connect(function()
            task.wait(0.1)
            applySpeedBoost()
        end)
    end)

    addButton("Jump Boost", function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/kedd063/KdmlScripts/refs/heads/main/jump-boost"))()
    end)

    addButton("Float", function()
        -- Float GUI as original, embedded inside
        local floatActive = false
        local floatSpeed = 46
        local floatTime = 15
        local startTime = 0

        local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
        gui.Name = "FloatGUI"
        gui.ResetOnSpawn = false

        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(0, 220, 0, 120)
        frame.Position = UDim2.new(0.5, -110, 0.7, 0)
        frame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
        frame.BorderColor3 = Color3.fromRGB(0, 170, 255)
        frame.BorderSizePixel = 3
        frame.Active = true
        frame.Draggable = true
        frame.Parent = gui

        local title = Instance.new("TextLabel")
        title.Size = UDim2.new(1, 0, 0, 30)
        title.BackgroundTransparency = 1
        title.Text = "Float"
        title.Font = Enum.Font.GothamBold
        title.TextSize = 18
        title.TextColor3 = Color3.fromRGB(0, 170, 255)
        title.Parent = frame

        local button = Instance.new("TextButton")
        button.Size = UDim2.new(0, 180, 0, 40)
        button.Position = UDim2.new(0.5, -90, 0, 40)
        button.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
        button.TextColor3 = Color3.new(1,1,1)
        button.TextScaled = true
        button.Font = Enum.Font.GothamBold
        button.Text = "Start Float"
        button.Parent = frame

        local countdownLabel = Instance.new("TextLabel")
        countdownLabel.Size = UDim2.new(0, 180, 0, 25)
        countdownLabel.Position = UDim2.new(0.5, -90, 0, 85)
        countdownLabel.BackgroundTransparency = 1
        countdownLabel.TextColor3 = Color3.new(1, 1, 1)
        countdownLabel.Font = Enum.Font.Gotham
        countdownLabel.TextScaled = true
        countdownLabel.Text = "Ready"
        countdownLabel.Parent = frame

        local moveConnection, gravityConnection

        local function stopFloat()
            floatActive = false
            button.Text = "Start Float"
            if moveConnection then moveConnection:Disconnect() end
            if gravityConnection then gravityConnection:Disconnect() end
            countdownLabel.Text = "Done"
            gui:Destroy()
        end

        local function startFloat()
            floatActive = true
            button.Text = "Stop Float"
            startTime = tick()
            local char = player.Character or player.CharacterAdded:Wait()
            local hrp = char:WaitForChild("HumanoidRootPart")

            gravityConnection = RunService.Heartbeat:Connect(function()
                hrp.Velocity = Vector3.new(hrp.Velocity.X, 0, hrp.Velocity.Z)
            end)

            moveConnection = RunService.Heartbeat:Connect(function()
                if not floatActive then return end
                local elapsed = tick() - startTime
                local remaining = floatTime - elapsed
                countdownLabel.Text = string.format("Ending in: %.1f", math.max(remaining, 0))
                if remaining <= 0 then
                    stopFloat()
                else
                    local dir = workspace.CurrentCamera.CFrame.LookVector
                    local move = Vector3.new(dir.X, 0, dir.Z).Unit
                    hrp.Velocity = move * floatSpeed
                end
            end)
        end

        button.MouseButton1Click:Connect(function()
            if not floatActive then startFloat() else stopFloat() end
        end)
    end)

    addButton("ROOF TP(NEW)", function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/kedd063/KdmlScripts/refs/heads/main/roof-tp"))()
    end)

    addButton("TWEEN STEAL(FOR ROOF TP)", function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/kedd063/KdmlScripts/refs/heads/main/tween-steal"))()
    end)
end

-- Visual tab content
contentUpdateFunctions["Visual"] = function()
    clearContent()
    local y = 0

    local espEnabled = false
    local espObjects = {}

    local function toggleESP(Value)
        espEnabled = Value
        if espEnabled then
            for _, plr in pairs(Players:GetPlayers()) do
                if plr ~= player and plr.Character then
                    -- Billboard
                    local head = plr.Character:FindFirstChild("Head")
                    if head and not head:FindFirstChild("ESP_NameTag") then
                        local billboard = Instance.new("BillboardGui")
                        billboard.Name = "ESP_NameTag"
                        billboard.Adornee = head
                        billboard.Size = UDim2.new(0, 100, 0, 30)
                        billboard.StudsOffset = Vector3.new(0, 2, 0)
                        billboard.AlwaysOnTop = true
                        billboard.Parent = head

                        local label = Instance.new("TextLabel")
                        label.BackgroundTransparency = 1
                        label.Size = UDim2.new(1, 0, 1, 0)
                        label.TextColor3 = Color3.fromRGB(255, 255, 255)
                        label.TextStrokeTransparency = 0
                        label.Font = Enum.Font.GothamBold
                        label.TextScaled = true
                        label.Text = plr.Name
                        label.Parent = billboard
                    end

                    -- Highlight
                    if not plr.Character:FindFirstChild("ESP_Highlight") then
                        local highlight = Instance.new("Highlight")
                        highlight.Name = "ESP_Highlight"
                        highlight.Adornee = plr.Character
                        highlight.FillColor = Color3.fromRGB(170,0,255)
                        highlight.FillTransparency = 0.5
                        highlight.OutlineTransparency = 0.7
                        highlight.Parent = plr.Character
                    end
                end
            end
        else
            for _, plr in pairs(Players:GetPlayers()) do
                if plr.Character then
                    local head = plr.Character:FindFirstChild("Head")
                    if head and head:FindFirstChild("ESP_NameTag") then head.ESP_NameTag:Destroy() end
                    if plr.Character:FindFirstChild("ESP_Highlight") then plr.Character.ESP_Highlight:Destroy() end
                end
            end
        end
    end

    local secretBrainrotsConnection
    local godBrainrotsConnection

    local function toggleSecretBrainrotsESP(Value)
        if Value then
            secretBrainrotsConnection = RunService.RenderStepped:Connect(function()
                for _, model in pairs(workspace:GetChildren()) do
                    if table.find({
                        "Chimpanzini Spiderini", "Los Tralaleritos", "La Vacca Saturno Saturnita",
                        "Torrtuginni Dragonfruitini", "Graipuss Medussi", "La Grande Combinasion",
                        "Garamam and Madundung", "Las Tralaleritas"
                    }, model.Name) then
                        local head = model:FindFirstChild("Head") or model:FindFirstChildWhichIsA("BasePart")
                        if head and not head:FindFirstChild("ESPBox") then
                            local box = Instance.new("BoxHandleAdornment")
                            box.Name = "ESPBox"
                            box.Adornee = head
                            box.Size = head.Size * Vector3.new(1.1, 1.3, 1.1)
                            box.Color3 = Color3.fromRGB(0,255,0)
                            box.AlwaysOnTop = true
                            box.Transparency = 0.5
                            box.Parent = head
                        end
                    end
                end
            end)
        else
            if secretBrainrotsConnection then secretBrainrotsConnection:Disconnect() end
            for _, model in pairs(workspace:GetChildren()) do
                local head = model:FindFirstChild("Head") or model:FindFirstChildWhichIsA("BasePart")
                if head and head:FindFirstChild("ESPBox") then
                    head.ESPBox:Destroy()
                end
            end
        end
    end

    local function toggleGodBrainrotsESP(Value)
        if Value then
            godBrainrotsConnection = RunService.RenderStepped:Connect(function()
                for _, model in pairs(workspace:GetChildren()) do
                    if table.find({
                        "Bigmaw", "Biteki", "Suicide Clown", "Torro Dragon",
                        "Cream Puff", "Scara Mama", "Gyaraga", "Pirite", "Skullers"
                    }, model.Name) then
                        local head = model:FindFirstChild("Head") or model:FindFirstChildWhichIsA("BasePart")
                        if head and not head:FindFirstChild("ESPBox") then
                            local box = Instance.new("BoxHandleAdornment")
                            box.Name = "ESPBox"
                            box.Adornee = head
                            box.Size = head.Size * Vector3.new(1.1, 1.3, 1.1)
                            box.Color3 = Color3.fromRGB(255, 0, 0)
                            box.AlwaysOnTop = true
                            box.Transparency = 0.5
                            box.Parent = head
                        end
                    end
                end
            end)
        else
            if godBrainrotsConnection then godBrainrotsConnection:Disconnect() end
            for _, model in pairs(workspace:GetChildren()) do
                local head = model:FindFirstChild("Head") or model:FindFirstChildWhichIsA("BasePart")
                if head and head:FindFirstChild("ESPBox") then
                    head.ESPBox:Destroy()
                end
            end
        end
    end

    createToggle("Player ESP", false, toggleESP).Position = UDim2.new(0, 10, 0, y)
    y = y + 45
    createToggle("Secret Brainrots ESP", false, toggleSecretBrainrotsESP).Position = UDim2.new(0, 10, 0, y)
    y = y + 45
    createToggle("God Brainrots ESP", false, toggleGodBrainrotsESP).Position = UDim2.new(0, 10, 0, y)
end

-- Misc tab content
contentUpdateFunctions["Misc"] = function()
    clearContent()
    local y = 0

    createButton("Auto Chest", function()
        local chestPosition = workspace:FindFirstChild("Chest") and workspace.Chest.Position or Vector3.new(0,0,0)
        if not chestPosition then
            warn("Chest not found!")
            return
        end
        local originalPos = player.Character.HumanoidRootPart.CFrame

        local tweenService = game:GetService("TweenService")

        local function tpToChest()
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                player.Character.HumanoidRootPart.CFrame = CFrame.new(chestPosition + Vector3.new(0,5,0))
            end
        end

        tpToChest()

        -- Optionally you can add auto-opening loop here
        -- But since original code lacks logic for auto open, just teleport for demo
    end).Position = UDim2.new(0, 10, 0, y)
    y = y + 45

    createButton("Server Hop", function()
        TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId)
    end).Position = UDim2.new(0, 10, 0, y)
    y = y + 45
end

-- Other tab content
contentUpdateFunctions["Other Stuffs"] = function()
    clearContent()
    local y = 0

    createButton("Rejoin Server", function()
        TeleportService:Teleport(game.PlaceId)
    end).Position = UDim2.new(0, 10, 0, y)
    y = y + 45

    createButton("Destroy UI", function()
        ScreenGui:Destroy()
    end).Position = UDim2.new(0, 10, 0, y)
    y = y + 45
end

-- Create tab buttons on TabsFrame
for i, tabName in ipairs(tabs) do
    local tabBtn = Instance.new("TextButton")
    tabBtn.Size = UDim2.new(1, -20, 0, 40)
    tabBtn.Position = UDim2.new(0, 10, 0, (i-1)*50 + 10)
    tabBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    tabBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
    tabBtn.Font = Enum.Font.GothamBold
    tabBtn.TextSize = 16
    tabBtn.Text = tabName
    tabBtn.Parent = TabsFrame

    tabBtn.MouseButton1Click:Connect(function()
        for _, btn in pairs(buttons) do
            btn.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
            btn.TextColor3 = Color3.fromRGB(200, 200, 200)
        end
        tabBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
        tabBtn.TextColor3 = Color3.new(1, 1, 1)
        contentUpdateFunctions[tabName]()
    end)

    table.insert(buttons, tabBtn)
end

-- Select first tab by default
buttons[1].BackgroundColor3 = Color3.fromRGB(0, 170, 255)
buttons[1].TextColor3 = Color3.new(1, 1, 1)
contentUpdateFunctions[tabs[1]]()
