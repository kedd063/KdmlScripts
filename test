local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local player = Players.LocalPlayer

-- Ana GUI
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "KdmlGui"

-- Ana Buton (Men√ºy√º a√ß/kapa)
local mainButton = Instance.new("ImageButton")
mainButton.Size = UDim2.new(0, 100, 0, 100)
mainButton.Position = UDim2.new(0, 10, 0.6, -50)
mainButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
mainButton.AnchorPoint = Vector2.new(0, 0.5)
mainButton.Image = "rbxassetid://104833147631294"
mainButton.Name = "MainButton"
mainButton.Parent = screenGui
Instance.new("UICorner", mainButton).CornerRadius = UDim.new(0, 20)

-- Men√º Frame
local menuFrame = Instance.new("Frame")
menuFrame.Size = UDim2.new(0, 350, 0, 400)
menuFrame.Position = UDim2.new(0.25, 0, 0.5, -200)
menuFrame.BackgroundColor3 = Color3.fromRGB(140, 90, 255)
menuFrame.Active = true
menuFrame.Draggable = true
menuFrame.Visible = false
menuFrame.Name = "MenuFrame"
menuFrame.Parent = screenGui
Instance.new("UICorner", menuFrame).CornerRadius = UDim.new(0, 14)

-- Gradient Arka Plan
local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new{
	ColorSequenceKeypoint.new(0, Color3.fromRGB(200, 150, 255)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 255, 255))
}
gradient.Rotation = 45
gradient.Parent = menuFrame

-- Ba≈ülƒ±k
local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, 0, 0, 50)
titleLabel.Position = UDim2.new(0, 0, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "Kdml Scripts"
titleLabel.TextColor3 = Color3.new(1, 1, 1)
titleLabel.TextScaled = true
titleLabel.Font = Enum.Font.GothamBold
titleLabel.Parent = menuFrame

-- Sekmeler ve i√ßerikleri
local tabNames = {"Main", "Visual", "Misc", "Other Stuffs"}
local tabs = {}
local contents = {}

for i, name in ipairs(tabNames) do
	local tabButton = Instance.new("TextButton")
	tabButton.Size = UDim2.new(0.25, 0, 0, 40)
	tabButton.Position = UDim2.new(0.25 * (i - 1), 0, 0, 50)
	tabButton.Text = name
	tabButton.Font = Enum.Font.Gotham
	tabButton.TextColor3 = Color3.new(1, 1, 1)
	tabButton.BackgroundColor3 = Color3.fromRGB(60, 40, 100)
	tabButton.Parent = menuFrame
	Instance.new("UICorner", tabButton).CornerRadius = UDim.new(0, 6)
	tabs[name] = tabButton

	local contentFrame = Instance.new("Frame")
	contentFrame.Size = UDim2.new(1, -20, 1, -100)
	contentFrame.Position = UDim2.new(0, 10, 0, 90)
	contentFrame.BackgroundColor3 = Color3.fromRGB(80, 60, 120)
	contentFrame.Visible = false
	contentFrame.Parent = menuFrame
	Instance.new("UICorner", contentFrame).CornerRadius = UDim.new(0, 6)
	contents[name] = contentFrame
end

-- Buton olu≈üturma fonksiyonu
local function createMainButton(parent, text, callback)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0, 200, 0, 40)
	btn.Position = UDim2.new(0.5, -100, 0, #parent:GetChildren() * 50)
	btn.Text = text
	btn.Font = Enum.Font.GothamBold
	btn.TextScaled = true
	btn.BackgroundColor3 = Color3.fromRGB(90, 60, 160)
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Parent = parent
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
	btn.MouseButton1Click:Connect(callback)
end

-- MAIN sekmesine butonlar

-- Speed Boost
createMainButton(contents["Main"], "Speed Boost üèÉ‚Äç‚ôÇÔ∏èüëü", function()
	local boostedSpeed = 44
	local function applySpeedBoost()
		local char = player.Character or player.CharacterAdded:Wait()
		local humanoid = char:WaitForChild("Humanoid")
		humanoid.WalkSpeed = boostedSpeed
	end
	applySpeedBoost()
	player.CharacterAdded:Connect(function()
		task.wait(0.1)
		applySpeedBoost()
	end)
end)

-- Jump Boost
createMainButton(contents["Main"], "Jump Boost üîºüôç", function()
	local jumpHeight = 40
	local jumpCooldown = 1
	local canJump = true
	UIS.JumpRequest:Connect(function()
		if canJump then
			canJump = false
			local char = player.Character or player.CharacterAdded:Wait()
			local hrp = char:WaitForChild("HumanoidRootPart")
			hrp.CFrame = hrp.CFrame + Vector3.new(0, jumpHeight, 0)
			task.delay(jumpCooldown, function()
				canJump = true
			end)
		end
	end)
end)

-- Float
createMainButton(contents["Main"], "Float üïäÔ∏è", function()
	local floatActive = false
	local floatSpeed = 46
	local floatTime = 5
	local startTime = 0

	local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
	gui.Name = "Float üïä"
	gui.ResetOnSpawn = false

	local frame = Instance.new("Frame")
	frame.Size = UDim2.new(0, 220, 0, 120)
	frame.Position = UDim2.new(0.5, -110, 0.7, 0)
	frame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
	frame.BorderColor3 = Color3.fromRGB(0, 170, 255)
	frame.BorderSizePixel = 3
	frame.Active = true
	frame.Draggable = true
	frame.Parent = gui

	local title = Instance.new("TextLabel")
	title.Size = UDim2.new(1, 0, 0, 30)
	title.BackgroundTransparency = 1
	title.Text = "Float üïä"
	title.Font = Enum.Font.GothamBold
	title.TextSize = 18
	title.TextColor3 = Color3.fromRGB(0, 170, 255)
	title.Parent = frame

	local button = Instance.new("TextButton")
	button.Size = UDim2.new(0, 180, 0, 40)
	button.Position = UDim2.new(0.5, -90, 0, 40)
	button.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
	button.TextColor3 = Color3.new(1,1,1)
	button.TextScaled = true
	button.Font = Enum.Font.GothamBold
	button.Text = "Float"
	button.Parent = frame

	local countdownLabel = Instance.new("TextLabel")
	countdownLabel.Size = UDim2.new(0, 180, 0, 25)
	countdownLabel.Position = UDim2.new(0.5, -90, 0, 85)
	countdownLabel.BackgroundTransparency = 1
	countdownLabel.TextColor3 = Color3.new(1, 1, 1)
	countdownLabel.Font = Enum.Font.Gotham
	countdownLabel.TextScaled = true
	countdownLabel.Text = "Ready"
	countdownLabel.Parent = frame

	local moveConnection, gravityConnection
	local function stopFloat()
		floatActive = false
		button.Text = "Float"
		if moveConnection then moveConnection:Disconnect() end
		if gravityConnection then gravityConnection:Disconnect() end
	end

	local function startFloat()
		floatActive = true
		button.Text = "Stop"
		startTime = tick()
		local char = player.Character or player.CharacterAdded:Wait()
		local hrp = char:WaitForChild("HumanoidRootPart")

		gravityConnection = RunService.Heartbeat:Connect(function()
			hrp.Velocity = Vector3.new(hrp.Velocity.X, 0, hrp.Velocity.Z)
		end)

		moveConnection = RunService.Heartbeat:Connect(function()
			if not floatActive then return end
			local elapsed = tick() - startTime
			local remaining = floatTime - elapsed
			countdownLabel.Text = string.format("Ending in: %.1f", math.max(remaining, 0))
			if remaining <= 0 then
				stopFloat()
				countdownLabel.Text = "Done"
			else
				local dir = workspace.CurrentCamera.CFrame.LookVector
				local move = Vector3.new(dir.X, 0, dir.Z).Unit
				hrp.Velocity = move * floatSpeed
			end
		end)
	end

	button.MouseButton1Click:Connect(function()
		if not floatActive then startFloat() else stopFloat() end
	end)
end)

-- Instant Steal
createMainButton(contents["Main"], "Instant Steal (code: arbix hub)", function()
	loadstring(game:HttpGet("https://raw.githubusercontent.com/Youifpg/Steal-a-Brianrot/refs/heads/main/Slowversion.lua"))()
end)

-- Visual sekmesine ESP toggle
local espEnabled = false
local espObjects = {}

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local espEnabled = false
local espFolder = Instance.new("Folder", player.PlayerGui)
espFolder.Name = "ESPFolder"

-- Kutu rengi (lavanta moru)
local boxColor = Color3.fromRGB(180, 150, 255)

local function createESPForPlayer(targetPlayer)
	if targetPlayer == player then return end

	local function onCharacterAdded(char)
		-- √ñnce varsa temizle
		local existing = espFolder:FindFirstChild(targetPlayer.Name)
		if existing then existing:Destroy() end

		local hrp = char:WaitForChild("HumanoidRootPart", 5)
		if not hrp then return end

		-- BoxHandleAdornment kutu
		local box = Instance.new("BoxHandleAdornment")
		box.Name = targetPlayer.Name .. "_Box"
		box.Size = Vector3.new(4, 5, 2)
		box.Adornee = hrp
		box.AlwaysOnTop = true
		box.ZIndex = 5
		box.Color3 = boxColor
		box.Transparency = 0.4
		box.Parent = espFolder

		-- BillboardGui isim etiketi
		local billboard = Instance.new("BillboardGui")
		billboard.Name = targetPlayer.Name .. "_Billboard"
		billboard.Adornee = hrp
		billboard.Size = UDim2.new(0, 150, 0, 50)
		billboard.StudsOffset = Vector3.new(0, 2.5, 0)
		billboard.AlwaysOnTop = true
		billboard.Parent = espFolder

		local bg = Instance.new("Frame")
		bg.BackgroundColor3 = Color3.new(0, 0, 0)
		bg.BackgroundTransparency = 0.5
		bg.Size = UDim2.new(1, 0, 1, 0)
		bg.Parent = billboard

		local nameLabel = Instance.new("TextLabel")
		nameLabel.BackgroundTransparency = 1
		nameLabel.Size = UDim2.new(1, 0, 1, 0)
		nameLabel.Font = Enum.Font.GothamBold
		nameLabel.TextSize = 20
		nameLabel.TextColor3 = Color3.new(1, 1, 1)
		nameLabel.TextStrokeTransparency = 0
		nameLabel.Text = targetPlayer.Name
		nameLabel.Parent = bg
	end

	if targetPlayer.Character then
		onCharacterAdded(targetPlayer.Character)
	end
	targetPlayer.CharacterAdded:Connect(onCharacterAdded)
end

local function enableESP()
	espEnabled = true
	for _, plr in pairs(Players:GetPlayers()) do
		createESPForPlayer(plr)
	end
	Players.PlayerAdded:Connect(createESPForPlayer)
end

local function disableESP()
	espEnabled = false
	espFolder:ClearAllChildren()
end

-- Toggle buton fonksiyonuna baƒülama √∂rneƒüi:
createMainButton(contents["Visual"], "ESP", function(button)
	if espEnabled then
		disableESP()
		button.Text = "ESP ‚ùå"
	else
		enableESP()
		button.Text = "ESP ‚úÖ"
	end
end)

-- Misc sekmesine item alma butonlarƒ±
local function createMiscButton(parent, itemName)
	createMainButton(parent, itemName, function()
		local ReplicatedStorage = game:GetService("ReplicatedStorage")
		local net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("Net"):WaitForChild("RF/CoinsShopService/RequestBuy")
		pcall(function()
			net:InvokeServer(itemName)
			print(itemName .. " satƒ±n alƒ±ndƒ±.")
		end)
	end)
end

local miscItems = {
	"Trap",
	"Invisibility Cloak",
	"Medusa's Head",
	"Quantum Cloner",
	"Body Swap Potion"
}

for _, item in ipairs(miscItems) do
	createMiscButton(contents["Misc"], item)
end

-- Other Stuffs sekmesine Auto Candy Spin Wheel toggle
local autoSpinEnabled = false
local autoSpinLoop

local otherStuffsFrame = contents["Other Stuffs"]

local autoSpinToggle = Instance.new("TextButton")
autoSpinToggle.Size = UDim2.new(0, 280, 0, 50)
autoSpinToggle.Position = UDim2.new(0.5, -140, 0, 0)
autoSpinToggle.BackgroundColor3 = Color3.fromRGB(75, 0, 130)
autoSpinToggle.Font = Enum.Font.GothamBold
autoSpinToggle.TextColor3 = Color3.new(1,1,1)
autoSpinToggle.TextScaled = true
autoSpinToggle.Text = "Auto Candy Spin Wheel üé°üç¨ [OFF]"
autoSpinToggle.Parent = otherStuffsFrame
Instance.new("UICorner", autoSpinToggle).CornerRadius = UDim.new(0, 10)

autoSpinToggle.MouseButton1Click:Connect(function()
	autoSpinEnabled = not autoSpinEnabled
	autoSpinToggle.Text = autoSpinEnabled and "Auto Candy Spin Wheel üé°üç¨ [ON]" or "Auto Candy Spin Wheel üé°üç¨ [OFF]"
	autoSpinToggle.BackgroundColor3 = autoSpinEnabled and Color3.fromRGB(0, 170, 0) or Color3.fromRGB(75, 0, 130)

	if autoSpinEnabled then
		autoSpinLoop = task.spawn(function()
			while autoSpinEnabled do
				local net = game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("Net")
				local spinEvent = net:WaitForChild("RE/CandyEventService/Spin")
				spinEvent:FireServer()
				task.wait(1)
			end
		end)
	else
		if autoSpinLoop then
			task.cancel(autoSpinLoop)
			autoSpinLoop = nil
		end
	end
end)

-- Auto Collect Money Toggle
local autoCollectEnabled = false
local autoCollectLoop

local autoCollectToggle = Instance.new("TextButton")
autoCollectToggle.Size = UDim2.new(0, 280, 0, 50)
autoCollectToggle.Position = UDim2.new(0.5, -140, 0, 120) -- Alt alta sƒ±ralƒ± olacak
autoCollectToggle.BackgroundColor3 = Color3.fromRGB(75, 0, 130)
autoCollectToggle.Font = Enum.Font.GothamBold
autoCollectToggle.TextColor3 = Color3.new(1,1,1)
autoCollectToggle.TextScaled = true
autoCollectToggle.Text = "Auto Collect Money üí∏ [OFF]"
autoCollectToggle.Parent = otherStuffsFrame
Instance.new("UICorner", autoCollectToggle).CornerRadius = UDim.new(0, 10)

-- Sahip olunan slotlarƒ± bul
local function getOwnedSlots()
	local ownedSlots = {}
	for _, plot in pairs(workspace.Plots:GetChildren()) do
		if plot:FindFirstChild("Owner") and plot.Owner.Value == player then
			local slotIdValue = plot:FindFirstChild("SlotId") or plot:FindFirstChild("ID") or plot:FindFirstChild("PlotId")
			if slotIdValue then
				table.insert(ownedSlots, slotIdValue.Value)
			end
		end
	end
	return ownedSlots
end

-- Toggle i≈ülevi
autoCollectToggle.MouseButton1Click:Connect(function()
	autoCollectEnabled = not autoCollectEnabled
	autoCollectToggle.Text = autoCollectEnabled and "Auto Collect Money üí∏ [ON]" or "Auto Collect Money üí∏ [OFF]"
	autoCollectToggle.BackgroundColor3 = autoCollectEnabled and Color3.fromRGB(0, 170, 0) or Color3.fromRGB(75, 0, 130)

	if autoCollectEnabled then
		autoCollectLoop = task.spawn(function()
			while autoCollectEnabled do
				local ownedSlots = getOwnedSlots()
				for _, slotId in pairs(ownedSlots) do
					pcall(function()
						remote:FireServer(slotId)
					end)
					task.wait(0.2)
				end
				task.wait(2)
			end
		end)
	else
		if autoCollectLoop then
			task.cancel(autoCollectLoop)
			autoCollectLoop = nil
		end
	end
end)


-- Sekme ge√ßi≈üi
for name, button in pairs(tabs) do
	button.MouseButton1Click:Connect(function()
		for otherName, frame in pairs(contents) do
			frame.Visible = (otherName == name)
		end
	end)
end

-- Men√º a√ß/kapa
local isOpen = false
mainButton.MouseButton1Click:Connect(function()
	isOpen = not isOpen
	menuFrame.Visible = isOpen
	if isOpen then
		for name, frame in pairs(contents) do
			frame.Visible = (name == "Main")
		end
	end
end)
