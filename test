local player = game.Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- DRAG FONKSİYONU
local function MakeDraggable(frame)
    local dragToggle, dragInput, dragStart, startPos
    local function update(input)
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragToggle = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragToggle = false
                end
            end)
        end
    end)
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragToggle then
            update(input)
        end
    end)
end

-- ANA GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "KdmlGui"
screenGui.Parent = player:WaitForChild("PlayerGui")

local mainButton = Instance.new("TextButton")
mainButton.Size = UDim2.new(0, 120, 0, 50)
mainButton.Position = UDim2.new(0.5, -60, 0.5, -25)
mainButton.Text = "Open Panel"
mainButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
mainButton.TextColor3 = Color3.fromRGB(255, 255, 255)
mainButton.Font = Enum.Font.GothamBold
mainButton.TextSize = 18
mainButton.Parent = screenGui

MakeDraggable(mainButton)

-- PANEL
local panel = Instance.new("Frame")
panel.Size = UDim2.new(0, 300, 0, 300)
panel.Position = UDim2.new(0.5, -150, 0.5, 50)
panel.BackgroundColor3 = Color3.fromRGB(50, 0, 80)
panel.Visible = false
panel.Parent = screenGui

MakeDraggable(panel)

-- SEKMELER
local tabMain = Instance.new("TextButton")
tabMain.Size = UDim2.new(0, 90, 0, 30)
tabMain.Position = UDim2.new(0, 10, 0, 10)
tabMain.Text = "Main"
tabMain.Parent = panel

local tabVisual = Instance.new("TextButton")
tabVisual.Size = UDim2.new(0, 90, 0, 30)
tabVisual.Position = UDim2.new(0, 110, 0, 10)
tabVisual.Text = "Visual"
tabVisual.Parent = panel

local tabMisc = Instance.new("TextButton")
tabMisc.Size = UDim2.new(0, 90, 0, 30)
tabMisc.Position = UDim2.new(0, 210, 0, 10)
tabMisc.Text = "Misc"
tabMisc.Parent = panel

local mainFrame = Instance.new("Frame", panel)
mainFrame.Size = UDim2.new(1, -20, 1, -50)
mainFrame.Position = UDim2.new(0, 10, 0, 50)
mainFrame.Visible = true

local visualFrame = Instance.new("Frame", panel)
visualFrame.Size = UDim2.new(1, -20, 1, -50)
visualFrame.Position = UDim2.new(0, 10, 0, 50)
visualFrame.Visible = false

local miscFrame = Instance.new("Frame", panel)
miscFrame.Size = UDim2.new(1, -20, 1, -50)
miscFrame.Position = UDim2.new(0, 10, 0, 50)
miscFrame.Visible = false

-- SEKMELER ARASI GEÇİŞ
tabMain.MouseButton1Click:Connect(function()
    mainFrame.Visible = true
    visualFrame.Visible = false
    miscFrame.Visible = false
end)

tabVisual.MouseButton1Click:Connect(function()
    mainFrame.Visible = false
    visualFrame.Visible = true
    miscFrame.Visible = false
end)

tabMisc.MouseButton1Click:Connect(function()
    mainFrame.Visible = false
    visualFrame.Visible = false
    miscFrame.Visible = true
end)

-- MAIN: TELEPORT + INSTANT STEAL
local teleportButton = Instance.new("TextButton", mainFrame)
teleportButton.Size = UDim2.new(0, 200, 0, 40)
teleportButton.Position = UDim2.new(0.5, -100, 0, 20)
teleportButton.Text = "Teleport 171 Up"
teleportButton.BackgroundColor3 = Color3.fromRGB(100, 0, 100)
teleportButton.TextColor3 = Color3.fromRGB(255,255,255)
teleportButton.Font = Enum.Font.GothamBold
teleportButton.TextSize = 18

local instantSteal = Instance.new("TextButton", mainFrame)
instantSteal.Size = UDim2.new(0, 200, 0, 40)
instantSteal.Position = UDim2.new(0.5, -100, 0, 70)
instantSteal.Text = "Instant Steal (Coming Soon..)"
instantSteal.BackgroundColor3 = Color3.fromRGB(100, 0, 100)
instantSteal.TextColor3 = Color3.fromRGB(255,255,255)
instantSteal.Font = Enum.Font.GothamBold
instantSteal.TextSize = 14

teleportButton.MouseButton1Click:Connect(function()
    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if hrp then hrp.CFrame = hrp.CFrame + Vector3.new(0, 171, 0) end
end)

-- VISUAL: ESP
local espButton = Instance.new("TextButton", visualFrame)
espButton.Size = UDim2.new(0, 200, 0, 40)
espButton.Position = UDim2.new(0.5, -100, 0, 20)
espButton.Text = "ESP: OFF"
espButton.BackgroundColor3 = Color3.fromRGB(0, 100, 100)
espButton.TextColor3 = Color3.fromRGB(255,255,255)
espButton.Font = Enum.Font.GothamBold
espButton.TextSize = 18

local espEnabled = false
local espLabels = {}

local function createEsp(plr)
    if espLabels[plr] then return end
    local char = plr.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end

    local billboard = Instance.new("BillboardGui")
    billboard.Adornee = char.HumanoidRootPart
    billboard.Size = UDim2.new(0, 100, 0, 30)
    billboard.AlwaysOnTop = true
    billboard.Parent = char.HumanoidRootPart

    local label = Instance.new("TextLabel", billboard)
    label.Size = UDim2.new(1,0,1,0)
    label.Text = plr.Name
    label.TextColor3 = Color3.new(1,0,0)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.GothamBold
    label.TextSize = 14

    espLabels[plr] = billboard
end

local function removeEsp(plr)
    if espLabels[plr] then
        espLabels[plr]:Destroy()
        espLabels[plr] = nil
    end
end

espButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    espButton.Text = espEnabled and "ESP: ON" or "ESP: OFF"
    if not espEnabled then
        for plr, _ in pairs(espLabels) do removeEsp(plr) end
    end
end)

RunService.RenderStepped:Connect(function()
    if espEnabled then
        for _, plr in pairs(game.Players:GetPlayers()) do
            if plr ~= player then
                if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                    createEsp(plr)
                else
                    removeEsp(plr)
                end
            end
        end
    end
end)

-- MISC: ITEM BUTONLARI
local items = {"Trap","Invisibility Cloak","Medusa's Head","Quantum Cloner","Body Swap Potion"}

for i, itemName in pairs(items) do
    local btn = Instance.new("TextButton", miscFrame)
    btn.Size = UDim2.new(0, 200, 0, 30)
    btn.Position = UDim2.new(0.5, -100, 0, (i-1)*40 + 20)
    btn.Text = "Buy: "..itemName
    btn.BackgroundColor3 = Color3.fromRGB(0, 100, 0)
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 16

    btn.MouseButton1Click:Connect(function()
        local args = {itemName}
        ReplicatedStorage:WaitForChild("Packages"):WaitForChild("Net"):WaitForChild("RF/CoinsShopService/RequestBuy"):InvokeServer(unpack(args))
    end)
end

-- MAIN BUTON PANEL TOGGLE
mainButton.MouseButton1Click:Connect(function()
    panel.Visible = not panel.Visible
end)
