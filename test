local player = game.Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- ScreenGui olu≈ütur
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "KdmlGui"
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Ana buton (solda)
local mainButton = Instance.new("ImageButton")
mainButton.Size = UDim2.new(0, 100, 0, 100)
mainButton.Position = UDim2.new(0, 10, 0.5, -50)
mainButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
mainButton.AnchorPoint = Vector2.new(0, 0.5)
mainButton.Image = "rbxassetid://104833147631294"
mainButton.Name = "MainButton"
mainButton.Parent = screenGui
Instance.new("UICorner", mainButton).CornerRadius = UDim.new(0, 20)

-- Drag mekanizmasƒ± (ana buton i√ßin)
local dragging = false
local dragInput, dragStart, startPos

local function update(input)
    local delta = input.Position - dragStart
    local newX = math.clamp(startPos.X.Offset + delta.X, 0, workspace.CurrentCamera.ViewportSize.X - mainButton.AbsoluteSize.X)
    local newY = math.clamp(startPos.Y.Offset + delta.Y, 0, workspace.CurrentCamera.ViewportSize.Y - mainButton.AbsoluteSize.Y)
    mainButton.Position = UDim2.new(0, newX, 0, newY)
    panel.Position = UDim2.new(0, newX + 110, 0, newY + mainButton.AbsoluteSize.Y/2)
end

mainButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or
       input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainButton.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

mainButton.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or
       input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Panel
local panel = Instance.new("Frame")
panel.Size = UDim2.new(0, 350, 0, 400)
panel.Position = UDim2.new(0, mainButton.Position.X.Offset + 110, 0, mainButton.Position.Y.Offset + mainButton.AbsoluteSize.Y/2)
panel.BackgroundColor3 = Color3.fromRGB(128, 0, 128)
panel.Visible = false
panel.AnchorPoint = Vector2.new(0, 0)
panel.Parent = screenGui
Instance.new("UICorner", panel).CornerRadius = UDim.new(0, 15)

-- Panel draggable ba≈ülƒ±k √ßubuƒüu
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 30)
titleBar.BackgroundColor3 = Color3.fromRGB(100, 0, 140)
titleBar.Parent = panel

local titleLabel = Instance.new("TextLabel")
titleLabel.Parent = titleBar
titleLabel.Size = UDim2.new(1, -10, 1, 0)
titleLabel.Position = UDim2.new(0, 5, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "Kdml Scripts"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 20
titleLabel.TextXAlignment = Enum.TextXAlignment.Left

local panelDragging = false
local panelDragInput, panelDragStart, panelStartPos

local function panelUpdate(input)
    local delta = input.Position - panelDragStart
    local newX = math.clamp(panelStartPos.X.Offset + delta.X, 0, workspace.CurrentCamera.ViewportSize.X - panel.AbsoluteSize.X)
    local newY = math.clamp(panelStartPos.Y.Offset + delta.Y, 0, workspace.CurrentCamera.ViewportSize.Y - panel.AbsoluteSize.Y)
    panel.Position = UDim2.new(0, newX, 0, newY)
end

titleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        panelDragging = true
        panelDragStart = input.Position
        panelStartPos = panel.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                panelDragging = false
            end
        end)
    end
end)

titleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        panelDragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == panelDragInput and panelDragging then
        panelUpdate(input)
    end
end)

-- Sekmeler
local tabs = {"Main", "Visual", "Misc", "Other Stuffs"}
local tabButtons, tabFrames = {}, {}

local function setActiveTab(tabName)
    for _, tab in ipairs(tabs) do
        tabFrames[tab].Visible = (tab == tabName)
        tabButtons[tab].BackgroundColor3 = (tab == tabName) and Color3.fromRGB(75,0,130) or Color3.fromRGB(40,40,40)
    end
    if tabName == "Misc" then
        panel.Size = UDim2.new(0, 350, 0, 400)
    else
        panel.Size = UDim2.new(0, 350, 0, 300)
    end
end

for i, tab in ipairs(tabs) do
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 100, 0, 30)
    btn.Position = UDim2.new(0, (i-1)*105 + 5, 0, 35)
    btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 18
    btn.Text = tab
    btn.Parent = panel
    tabButtons[tab] = btn

    btn.MouseButton1Click:Connect(function() setActiveTab(tab) end)

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -10, 1, -70)
    frame.Position = UDim2.new(0, 5, 0, 70)
    frame.BackgroundTransparency = 1
    frame.Visible = false
    frame.Parent = panel
    tabFrames[tab] = frame
end

setActiveTab("Main")

-- Main Sekmesi: Speed Boost, Jump Boost, Float

local mainFrame = tabFrames["Main"]

-- Speed Boost Button
local speedBoostBtn = Instance.new("TextButton")
speedBoostBtn.Size = UDim2.new(0, 330, 0, 40)
speedBoostBtn.Position = UDim2.new(0, 10, 0, 10)
speedBoostBtn.BackgroundColor3 = Color3.fromRGB(75, 0, 130)
speedBoostBtn.TextColor3 = Color3.new(1,1,1)
speedBoostBtn.Font = Enum.Font.GothamBold
speedBoostBtn.TextSize = 18
speedBoostBtn.Text = "Speed Boost üèÉ‚Äç‚ôÇÔ∏èüëü [OFF]"
speedBoostBtn.Parent = mainFrame
Instance.new("UICorner", speedBoostBtn).CornerRadius = UDim.new(0, 10)

local speedBoostActive = false
local boostedSpeed = 44

local Players = game:GetService("Players")
local player = Players.LocalPlayer

local function applySpeedBoost()
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid")
    humanoid.WalkSpeed = boostedSpeed
end

speedBoostBtn.MouseButton1Click:Connect(function()
    speedBoostActive = not speedBoostActive
    if speedBoostActive then
        applySpeedBoost()
        speedBoostBtn.Text = "Speed Boost üèÉ‚Äç‚ôÇÔ∏èüëü [ON]"
        speedBoostBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
    else
        local character = player.Character
        if character then
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid.WalkSpeed = 16 -- default speed
            end
        end
        speedBoostBtn.Text = "Speed Boost üèÉ‚Äç‚ôÇÔ∏èüëü [OFF]"
        speedBoostBtn.BackgroundColor3 = Color3.fromRGB(75, 0, 130)
    end
end)

player.CharacterAdded:Connect(function()
    if speedBoostActive then
        task.wait(0.1)
        applySpeedBoost()
    end
end)

-- Jump Boost Button
local jumpBoostBtn = Instance.new("TextButton")
jumpBoostBtn.Size = UDim2.new(0, 330, 0, 40)
jumpBoostBtn.Position = UDim2.new(0, 10, 0, 60)
jumpBoostBtn.BackgroundColor3 = Color3.fromRGB(75, 0, 130)
jumpBoostBtn.TextColor3 = Color3.new(1,1,1)
jumpBoostBtn.Font = Enum.Font.GothamBold
jumpBoostBtn.TextSize = 18
jumpBoostBtn.Text = "Jump Boost üîºüôç [OFF]"
jumpBoostBtn.Parent = mainFrame
Instance.new("UICorner", jumpBoostBtn).CornerRadius = UDim.new(0, 10)

local jumpBoostActive = false
local UIS = game:GetService("UserInputService")
local jumpHeight = 40
local jumpCooldown = 1
local canJump = true

local function onJumpRequest()
    if jumpBoostActive and canJump then
        canJump = false
        local character = player.Character or player.CharacterAdded:Wait()
        local hrp = character:WaitForChild("HumanoidRootPart")
        hrp.CFrame = hrp.CFrame + Vector3.new(0, jumpHeight, 0)
        task.delay(jumpCooldown, function()
            canJump = true
        end)
    end
end

jumpBoostBtn.MouseButton1Click:Connect(function()
    jumpBoostActive = not jumpBoostActive
    jumpBoostBtn.Text = jumpBoostActive and "Jump Boost üîºüôç [ON]" or "Jump Boost üîºüôç [OFF]"
    jumpBoostBtn.BackgroundColor3 = jumpBoostActive and Color3.fromRGB(0, 170, 0) or Color3.fromRGB(75, 0, 130)
end)

UIS.JumpRequest:Connect(onJumpRequest)

-- Float Button
local floatBtn = Instance.new("TextButton")
floatBtn.Size = UDim2.new(0, 330, 0, 40)
floatBtn.Position = UDim2.new(0, 10, 0, 110)
floatBtn.BackgroundColor3 = Color3.fromRGB(75, 0, 130)
floatBtn.TextColor3 = Color3.new(1,1,1)
floatBtn.Font = Enum.Font.GothamBold
floatBtn.TextSize = 18
floatBtn.Text = "Float üïäÔ∏è [OFF]"
floatBtn.Parent = mainFrame
Instance.new("UICorner", floatBtn).CornerRadius = UDim.new(0, 10)

local floatActive = false
local floatSpeed = 46
local floatTime = 5
local startTime = 0

local moveConnection
local gravityConnection

local function stopFloat()
    floatActive = false
    floatBtn.Text = "Float üïäÔ∏è [OFF]"
    floatBtn.BackgroundColor3 = Color3.fromRGB(75, 0, 130)

    if moveConnection then moveConnection:Disconnect() end
    if gravityConnection then gravityConnection:Disconnect() end

    local character = player.Character
    if character then
        local hrp = character:FindFirstChild("HumanoidRootPart")
        if hrp then
            hrp.Velocity = Vector3.new(0, hrp.Velocity.Y, 0)
        end
    end
end

local function startFloat()
    floatActive = true
    floatBtn.Text = "Float üïäÔ∏è [ON]"
    floatBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
    startTime = tick()

    local character = player.Character or player.CharacterAdded:Wait()
    local hrp = character:WaitForChild("HumanoidRootPart")

    -- Sabit havada kalma
    gravityConnection = RunService.Heartbeat:Connect(function()
        hrp.Velocity = Vector3.new(hrp.Velocity.X, 0, hrp.Velocity.Z)
    end)

    -- Kamera y√∂n√ºne g√∂re ileri kayma ve s√ºre kontrol
    moveConnection = RunService.Heartbeat:Connect(function()
        if not floatActive then return end

        local elapsed = tick() - startTime
        local remaining = floatTime - elapsed

        if remaining <= 0 then
            stopFloat()
        else
            local cameraDirection = workspace.CurrentCamera.CFrame.LookVector
            local moveDirection = Vector3.new(cameraDirection.X, 0, cameraDirection.Z).Unit
            hrp.Velocity = moveDirection * floatSpeed
        end
    end)
end

floatBtn.MouseButton1Click:Connect(function()
    if not floatActive then
        startFloat()
    else
        stopFloat()
    end
end)

-- Other Stuffs Sekmesi: Auto Candy Spin Wheel Toggle
local otherFrame = tabFrames["Other Stuffs"]

local autoSpinToggle = Instance.new("TextButton")
autoSpinToggle.Parent = otherFrame
autoSpinToggle.Size = UDim2.new(0, 330, 0, 40)
autoSpinToggle.Position = UDim2.new(0, 10, 0, 10)
autoSpinToggle.BackgroundColor3 = Color3.fromRGB(75, 0, 130)
autoSpinToggle.TextColor3 = Color3.new(1,1,1)
autoSpinToggle.Font = Enum.Font.GothamBold
autoSpinToggle.TextSize = 18
autoSpinToggle.Text = "Auto Candy Spin Wheel üé°üç¨ [OFF]"
Instance.new("UICorner", autoSpinToggle).CornerRadius = UDim.new(0, 10)

local autoSpinEnabled = false
local autoSpinLoop

autoSpinToggle.MouseButton1Click:Connect(function()
    autoSpinEnabled = not autoSpinEnabled
    autoSpinToggle.Text = autoSpinEnabled and "Auto Candy Spin Wheel üé°üç¨ [ON]" or "Auto Candy Spin Wheel üé°üç¨ [OFF]"
    autoSpinToggle.BackgroundColor3 = autoSpinEnabled and Color3.fromRGB(0, 170, 0) or Color3.fromRGB(75, 0, 130)

    if autoSpinEnabled then
        autoSpinLoop = task.spawn(function()
            while autoSpinEnabled do
                local net = game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("Net")
                local spinEvent = net:WaitForChild("RE/CandyEventService/Spin")
                spinEvent:FireServer()
                task.wait(1) -- 1 saniyede bir spin yapar, istersen burayƒ± deƒüi≈ütir
            end
        end)
    else
        if autoSpinLoop then
            task.cancel(autoSpinLoop)
            autoSpinLoop = nil
        end
    end
end)

-- Ana butona tƒ±klayƒ±nca panel a√ßƒ±lƒ±r/kapanƒ±r
mainButton.MouseButton1Click:Connect(function()
    panel.Visible = not panel.Visible
end)
